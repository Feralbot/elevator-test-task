# elevator-test-task

Здравствуйте, спасибо что повторно взялись за ревью корректировок моего тестового задания!
Основная ветка nogsap.
Реализовал систему масштабирования этажей / лифтов. В ходе разработки точно забрел куда-то не туда, система получилось сложной, но она работает. Для упрощения понимания кода ниже в описании подробно описал его особенности.

## Установка и запуск

В проекте отсутствуют глобальные зависимости, можно установить командой:

```
npm install
```

Для запуска dev билда используйте команду:

```
npm run start
```

Для запуска production билда, нужно изменить publicPath в Vue.comfig.js, т.к. он настроен на деплой в gh-pages.

## Рабочая демка:

[https://feralbot.github.io/elevator-test-task/](https://feralbot.github.io/elevator-test-task/)

## Принцип работы системы
Модель системы подьема лифтов представлена в 3 элементах: 
(1) массив лифтов, где лифт - объект, хранящий в себе характеристики; 
(2) массив очередности вызовов лифта;
(3) Массив заказов, где заказ - объект с 3 свойствами:  {этаж вызова лифта, Лифт который едет на вызов, Статус заказа (выполнен / находится в очереди)}

При нажатии на кнопку вызова, значение этажа пушится в (2) массив очередей вызов и в (3) Массив заказов ( с пустым значением лифта и статусом "inQueue").

Срабатывает wathcer, который определяет, какой лифт из (1) массива лифтов готов взяться за заказ, при наличии свободного, лифт направляется на заказ, значение лифта парсится с (3) массивом  заказов.

По прибытии в точку назначения, статус лифта меняется на Arraved, запускается анимация, статус заказа в (3) меняется на "done". Из массива (2) удаляется завершенный вызов,
при удалении которого срабатывает Wathcer, отслеживающий (2) массив очередей вызовов и запускающий цикл заново.

## Что не удалось реализовать и почему
### Написать красивый код

После получения ревью и замечаний, начал думать, как реализовать многолифтовую систему. Быстро понял, что лифты нужно представить как массив объектов, но столкнулся с проблемой написания логики работы системы подъема из за реактивности. Присходили нежелательные перерасчеты  параметров  лифта и вытекающие из этого проблемы: то лифты вместе отправлялись на 1 вызов, то после исполнения вызова не отправлялись на следующий заказ. Затем удалось сделать некрасивую, но рабочую систему  - здесь и кроется основная ошибка, нужно было уделить ей больше внимания, сразу вынести в отдельную функцию, а не пытаться нанизывать костыли, потому что чем дальше - тем сложнее было разобраться, что проиходит внутри системы, а это значительно ухудшают читабельность и семантику кода.

### Вызов ближайшего лифта

Следствие из первой проблемы.
В разных вариациях пытался внедрить систему по типу:
```
elevators.forEach((elevator)=>{
let nearest = {position: 1000000};
if (elevator.status=="rest" && nearest.position > elevator.position){
 nearest = elevator.position;
}
return nearest;
});
```
Но все попытки оказались неудачными, если (2) массив очереди вызовов был пуст - вызывалось два лифта. Сдался, оставил как есть, без внедрения этой фичи.

### Работа системы после перезагрузки страницы

Аналогично, следствие из первой проблемы, но чуть более душно.
При перезагрузке страницы и onMount загрузке данных из local Storage намертво виснет Watcher,отслеживающий загруженные данные, а сами лифты остаются в том же состоянии, что и до загрузки. В devTools не было ни единой ошибки. Крайне тяжело дебажить.
Пробовал всякое: сбрасывать состояния лифтов в onBeforeUnmount, перезапускать движение лифтов в функции resetAfterReload, загружал local storage данные в копии массивов, чтобы протестировать запуск лифтов уже из них.
 Вообщем треш. рабочего варианта не добился. Сдался.




## Итоговые мысли
В целом, система работает.
Уже после написания кода понимаю, что идеально было бы откатиться назад, переписать систему выбора лифта, очередь сделать через map [Этаж, лифт], тогда, возможно, и с вызовов ближайшего лифта и с перезагрузкой страницы проблем бы не возникало. Но, что получилось. 
При наличии более эталонных работ от других кандитатов, хотелось бы на них взглянуть и оценить, как еще можно было реализовать эту задачу.


### Спасибо за предоставление тестового задания и уделенное время! 
### Надеюсь на дальнейшее сотрудничество!
